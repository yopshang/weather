<template>
  <div id="TW_map">
    <div class="taivan-map" ref="map">
      <div id="map">
        <svg
          id="svg"
          xmlns="http://www.w3.org/2000/svg"
          preserveAspectRatio="xMidYMid meet"
          width="720"
          height="789"
          viewBox="0 0 720 789"
        >
          <path v-for="(path, i) in country_data" :d="path.d" :id="path.id" :key="i" @click="get_active(path.name)"></path>
        </svg>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  name: "tw-map",
  data() {
    return {
      h1: "",
      h2: "",
      sampleData: [],
      country_data: [
        { id: "city10002", name: "宜蘭縣", d:"M545.4640410045286,108.19640664393137L537.6992279278675,111.27180195507208L523.4481718127645,127.87984274649625L517.3676373133458,146.26485989002867L517.6160116110914,158.0047094683514L523.5938799446812,183.2955069039608L530.0761811221237,189.29921503952573L523.3258748642002,213.50243694218625L513.9449757549228,224.16526607152537L508.6082165974585,249.2612153537666L497.1429695830593,246.84950205318273L481.1323029546402,237.613582642216L476.53850242975386,249.81672806308143L446.77873360401645,238.85097848886107L444.0476513265785,235.0157353898503L431.72083621033016,238.1166110530594L424.98247053520754,233.50296999094462L420.98612382439387,222.6583197993814L425.73818242826746,214.17413741530618L437.1067668778596,204.1467235564678L437.37792130025264,190.96053407283398L442.132404306074,187.92443835604172L448.2157529394826,173.75763411332719L452.15111580417215,173.61151732637063L462.9460058860677,170.56723123555912L472.82628053823646,163.78929782753585L473.6455540763418,149.58809103661497L486.75003835739335,144.59617658006027L512.1496035848504,125.78722585127525L523.5944445761561,120.76295417096844L522.6449719367629,113.0088121434128Z" },
        { id: "city10007", name: "彰化縣", d: "M255.66560066375314,272.023583668225L264.8479535782535,275.3997254887772L270.19731183123804,288.9134364207639L285.57885517508475,294.0333334823308L288.70631296556894,309.3740126389448L298.30345498323004,312.65066274270885L291.17903708598897,313.8878831951479L289.8025817227717,337.9898317139505L286.8273054555066,348.84987794663994L290.9555682003338,360.5252601846996L266.12785427290146,357.5784963840779L251.16348373311848,351.2711637540933L227.1683648834587,353.33764163527303L216.9725424517892,350.4098336050056L210.31894752316293,343.6994763320663L232.1631487825871,312.6699581275607L233.6881623131303,302.96022492299653L244.19898843537158,290.89629217424226L247.8945539865963,279.9482474119568Z" },
        { id: "city10008", name: "南投縣", d: "M425.8538737070303,268.5779645993425L415.31396052089985,278.23697603512846L414.0186043597496,287.03069511627655L422.0363748291311,297.7434617700492L414.37175916750857,304.1931973405881L409.9376527785462,317.21312581769416L413.35476939104046,322.77957312865783L411.53867442062983,340.0192993969149L399.4194455541874,363.6557247038745L406.30173331343394,376.68525723563835L400.9163035379497,399.51506377103306L392.52426054478565,402.34496122858036L388.21329430784317,414.78189699402265L373.1553604367655,416.6072159899122L362.93129145685816,433.9937667927152L351.8434469175372,426.85910928605335L329.0849059206048,426.4997247679812L323.2557863966467,412.898468096997L326.1536290546974,402.22222807244L308.32946080567854,397.26779559828356L294.95522859324774,397.3382321564741L288.7871683451267,392.1636678273335L292.47113236122823,382.1549349080651L290.9555682003338,360.5252601846996L286.8273054555066,348.84987794663994L289.8025817227717,337.9898317139505L291.17903708598897,313.8878831951479L298.30345498323004,312.65066274270885L315.9505447443371,313.6927926362978L330.2125809352219,289.41710337731274L344.61812375206136,293.01116625540453L359.7354082424863,288.9153686055024L380.28952413039224,274.1225710690287L385.9738405454518,274.3337472792191L408.96944362821523,264.43786513349824Z"},
        { id: "city10009", name: "雲林縣", d: "M290.9555682003338,360.5252601846996L292.47113236122823,382.1549349080651L288.7871683451267,392.1636678273335L294.95522859324774,397.3382321564741L308.32946080567854,397.26779559828356L305.8490343902122,406.0170430203689L291.96366114349803,400.88670829557486L285.08727369666303,403.1753135018507L271.09757974694,400.6365575974369L264.6884664034842,392.13975600721733L245.31469944484707,393.88774479576205L223.54568382799698,407.66421034212726L210.834343164006,419.5708451445553L196.01287391763253,416.1151581045424L194.339600950334,395.26498854578676L191.81225924678438,390.4794853425019L200.49430913295873,366.21423848941777L198.14870100715416,360.86162039403644L210.31894752316293,343.6994763320663L216.9725424517892,350.4098336050056L227.1683648834587,353.33764163527303L251.16348373311848,351.2711637540933L266.12785427290146,357.5784963840779Z"},
        { id: "city10013", name: "屏東縣", d:"M333.9989759340169,557.6621437532613L341.4355780122314,566.6757565311427L337.6365268979971,583.9017689539323L321.15741716209595,589.721745455643L314.1771400212856,602.0090955005808L309.9849042049427,618.3504559768517L314.4427013092063,628.8164091744575L312.31323318716386,637.6858742660579L319.60294776213414,646.1163496855688L311.52734739624066,655.7552030195056L318.7347325214432,661.1279280983572L321.25605699294465,675.4598904368613L334.4043930379885,685.137577842509L340.0905555925092,681.6902575098075L338.47044284093863,705.1475946786413L339.5838976283958,722.4626017845558L336.1531467306813,733.0002969864381L330.4483517217377,735.6165749625734L325.8699006869647,746.349030110322L311.70526352002344,743.2231049397869L299.57036185869583,727.8111622861097L305.6394756739719,713.4452823440452L297.02979364866405,684.4238123402329L290.15174936078256,667.9235118484803L280.4368865780234,656.1737586570225L256.04869111450535,641.6426607148369L249.49989896632178,635.5445685399018L253.00786096120282,616.0910683005004L251.84132985597898,594.7326813691134L255.5108280945533,583.6044228686651L258.0091746955695,560.2462844803986L274.41259309720044,560.6315001603361L284.3239326552939,551.384303997519L291.85135342982903,548.8911292290632L297.93610413857823,554.7091711652365L310.59859486940695,551.3135446569277L317.5163035098558,559.303309568535L326.0107494557342,552.9451936005453Z"},
        { id: "city10017", name: "基隆市", d: "M514.2609706703115,75.7444109303251L505.3351637549422,81.27341937770325L500.59006081175175,93.43252446345468L485.8825695591404,84.7748596298361L482.7876685994561,73.73380155763152L496.24291515605,67.18398546589378Z"},
        { id: "city10018", name: "新竹市", d: "M347.6017162863136,165.42415592636644L335.9113740710236,159.98657746003937L345.64351177365097,135.35052850212105L363.484768331924,145.39101094833222L349.66008461645106,158.51547714300523Z"},
        { id: "city63000", name: "臺北市", d: "M469.62038754646346,62.81295203644186L480.68378321689306,86.28878076280489L474.3531576789901,103.09654649048844L467.7447012059747,112.0874284085703L462.49361109851816,103.84989999339723L452.85096719533976,97.13420024125935L457.34413584034337,89.80484089203674L449.38915503944736,76.7313219749285L456.51649055123926,67.98418337299518Z"},
        { id: "city65000", name: "新北市", d: "M496.24291515605,67.18398546589378L482.7876685994561,73.73380155763152L485.8825695591404,84.7748596298361L500.59006081175175,93.43252446345468L505.3351637549422,81.27341937770325L514.2609706703115,75.7444109303251L532.2241302214461,79.2450390649692L545.4640410045286,108.19640664393137L522.6449719367629,113.0088121434128L523.5944445761561,120.76295417096844L512.1496035848504,125.78722585127525L486.75003835739335,144.59617658006027L473.6455540763418,149.58809103661497L472.82628053823646,163.78929782753585L462.9460058860677,170.56723123555912L452.15111580417215,173.61151732637063L441.2902364115216,154.74951227779184L446.30102447374156,149.91962616565797L439.7966665757049,139.43695576279242L428.6894880643267,138.5859342508693L420.9705088173796,122.32475358580905L425.79530869529117,108.36155917727956L430.80028283887805,109.52492522034026L438.60962001524604,100.71116641457411L434.135247972863,91.21129988048688L418.14151414486696,84.10711399260072L414.404974703044,79.64497382034733L434.82873118118005,73.298063978772L446.9082000859016,51.00381197391562L470.91501934361077,41.21970419405989L479.6300290396757,46.52555457384187L485.91372258672345,59.38927727378177ZM469.62038754646346,62.81295203644186L456.51649055123926,67.98418337299518L449.38915503944736,76.7313219749285L457.34413584034337,89.80484089203674L452.85096719533976,97.13420024125935L462.49361109851816,103.84989999339723L467.7447012059747,112.0874284085703L474.3531576789901,103.09654649048844L480.68378321689306,86.28878076280489Z"},
        { id: "city66000", name: "台南市", d:"M446.77873360401645,238.85097848886107L441.25385771106085,250.7486258241379L433.0444817326461,256.80146372034415L425.8538737070303,268.5779645993425L408.96944362821523,264.43786513349824L385.9738405454518,274.3337472792191L380.28952413039224,274.1225710690287L359.7354082424863,288.9153686055024L344.61812375206136,293.01116625540453L330.2125809352219,289.41710337731274L315.9505447443371,313.6927926362978L298.30345498323004,312.65066274270885L288.70631296556894,309.3740126389448L285.57885517508475,294.0333334823308L270.19731183123804,288.9134364207639L264.8479535782535,275.3997254887772L255.66560066375314,272.023583668225L268.5654309004858,249.1551159322762L287.4011516843093,222.91138332113223L300.86036813190003,238.09183107409717L328.04591529151,254.48600552645985L341.6711224469909,254.11659337386027L347.6435631382192,243.43764042433122L360.9048717452024,245.74624381024387L366.7746704608908,253.07378283944036L383.4328802995624,244.82136447199446L396.5216330379553,235.2805589616255L404.4159101006626,234.84585661021538L409.71063829143895,223.38655581455896L420.98612382439387,222.6583197993814L424.98247053520754,233.50296999094462L431.72083621033016,238.1166110530594L444.0476513265785,235.0157353898503Z"},
        { id: "city67000", name: "台中市", d: "M293.46615008302615,478.08276910288623L278.36600420225295,505.87966143553786L256.4914852472575,524.1317783854156L247.97846981845214,542.3896186757102L236.0775853415471,547.8820407152216L201.56244634167524,543.3620926581143L201.03632404686869,535.4426964511695L193.88177256884228,525.0711673755786L179.13919525898746,515.9624699285423L173.36848946162718,509.27030275288325L182.89283126546798,483.109724292437L186.5038869795062,462.5037983286684L190.68182193447865,453.91651430183174L202.3165253919433,464.0423162559773L210.41735677855468,463.14910074994714L224.25611404372103,446.5519660928876L235.11643859621836,441.1251308422861L252.17224536426147,438.6013550881771L271.6852282488908,456.48687788031293L268.34701816386223,459.8285973209149L269.1558297970041,476.746730728546L279.0819730283729,480.0240428925981Z"},
        { id: "city68000", name: "桃園市", d: "M414.404974703044,79.64497382034733L418.14151414486696,84.10711399260072L434.135247972863,91.21129988048688L438.60962001524604,100.71116641457411L430.80028283887805,109.52492522034026L425.79530869529117,108.36155917727956L420.9705088173796,122.32475358580905L428.6894880643267,138.5859342508693L439.7966665757049,139.43695576279242L446.30102447374156,149.91962616565797L441.2902364115216,154.74951227779184L452.15111580417215,173.61151732637063L448.2157529394826,173.75763411332719L442.132404306074,187.92443835604172L437.37792130025264,190.96053407283398L431.56783836170143,190.52993032951326L427.81372411754637,175.20197637129422L417.4956485101684,169.02278403310356L419.0756219352588,156.46450764873225L405.73816333893774,145.96112571635422L389.1951438869801,137.6783191633558L389.8850534638259,129.87043261383315L371.7904071598605,124.98173103146655L367.395213881402,116.0078203054345L356.5491362421453,117.32524739674591L369.97495054361207,95.39172887625591L383.9993761440419,88.33824667663066L409.8726635239873,78.4142547195006Z"},
        { id: "city10005", name: "苗栗縣" , d:"M409.71063829143895,223.38655581455896L404.4159101006626,234.84585661021538L396.5216330379553,235.2805589616255L383.4328802995624,244.82136447199446L366.7746704608908,253.07378283944036L360.9048717452024,245.74624381024387L347.6435631382192,243.43764042433122L341.6711224469909,254.11659337386027L328.04591529151,254.48600552645985L300.86036813190003,238.09183107409717L287.4011516843093,222.91138332113223L299.4619159477952,205.803169831157L305.43868612021834,189.0042202370969L319.41182548238794,175.05834614581545L326.02863316389994,173.85933970277074L335.9113740710236,159.98657746003937L347.6017162863136,165.42415592636644L362.7609827869528,180.58240272372223L374.16643492590083,186.42285535435894L371.9388299768907,198.46608541734258L373.83417954578545,210.65115458614218L401.0797101113276,207.19780741004888Z"},
        { id: "city10004", name: "新竹縣",  d:"M347.6017162863136,165.42415592636644L349.66008461645106,158.51547714300523L363.484768331924,145.39101094833222L345.64351177365097,135.35052850212105L356.5491362421453,117.32524739674591L367.395213881402,116.0078203054345L371.7904071598605,124.98173103146655L389.8850534638259,129.87043261383315L389.1951438869801,137.6783191633558L405.73816333893774,145.96112571635422L419.0756219352588,156.46450764873225L417.4956485101684,169.02278403310356L427.81372411754637,175.20197637129422L431.56783836170143,190.52993032951326L437.37792130025264,190.96053407283398L437.1067668778596,204.1467235564678L425.73818242826746,214.17413741530618L420.98612382439387,222.6583197993814L409.71063829143895,223.38655581455896L401.0797101113276,207.19780741004888L373.83417954578545,210.65115458614218L371.9388299768907,198.46608541734258L374.16643492590083,186.42285535435894L362.7609827869528,180.58240272372223Z"},
        { id: "city10020", name: "嘉義市", d: "M253.94321551011672,416.6672122295122L265.7796534775007,425.741467799965L252.40523964610475,433.12596871300593L243.5474373208126,424.1639878538035Z"},
        { id: "city10010", name: "嘉義縣", d:"M308.32946080567854,397.26779559828356L326.1536290546974,402.22222807244L323.2557863966467,412.898468096997L329.0849059206048,426.4997247679812L351.8434469175372,426.85910928605335L331.042921134871,437.3255887027317L327.07968782291573,446.64075551870974L301.15832306235825,465.544541800381L291.60366087515285,463.1288949009222L293.46615008302615,478.08276910288623L279.0819730283729,480.0240428925981L269.1558297970041,476.746730728546L268.34701816386223,459.8285973209149L271.6852282488908,456.48687788031293L252.17224536426147,438.6013550881771L235.11643859621836,441.1251308422861L224.25611404372103,446.5519660928876L210.41735677855468,463.14910074994714L202.3165253919433,464.0423162559773L190.68182193447865,453.91651430183174L198.3048111443568,444.3742707086776L196.01287391763253,416.1151581045424L210.834343164006,419.5708451445553L223.54568382799698,407.66421034212726L245.31469944484707,393.88774479576205L264.6884664034842,392.13975600721733L271.09757974694,400.6365575974369L285.08727369666303,403.1753135018507L291.96366114349803,400.88670829557486L305.8490343902122,406.0170430203689ZM253.94321551011672,416.6672122295122L243.5474373208126,424.1639878538035L252.40523964610475,433.12596871300593L265.7796534775007,425.741467799965Z"},
        { id: "city64000", name: "高雄市" , d:"M362.93129145685816,433.9937667927152L364.98594389374193,440.7892235317322L357.7173527943851,447.53580802057695L369.2466874960628,456.90258648171766L365.43771031038705,462.9149629592921L354.2940021973991,466.3671126530444L343.76973569601614,475.3725966485217L338.47306210890747,496.4952957671967L338.7188680150248,503.98595285939973L333.24851812777706,523.2740246347657L325.61968581734254,533.0968037542034L327.081719997037,544.7167470286286L333.9989759340169,557.6621437532613L326.0107494557342,552.9451936005453L317.5163035098558,559.303309568535L310.59859486940695,551.3135446569277L297.93610413857823,554.7091711652365L291.85135342982903,548.8911292290632L284.3239326552939,551.384303997519L274.41259309720044,560.6315001603361L258.0091746955695,560.2462844803986L255.5108280945533,583.6044228686651L251.84132985597898,594.7326813691134L253.00786096120282,616.0910683005004L249.49989896632178,635.5445685399018L229.80199534074927,623.2679298044313L218.65516169212788,607.8600883603722L216.0006164482802,597.7046734654559L217.21504408310648,583.8534946623258L207.5594011770918,562.4374235797686L201.56244634167524,543.3620926581143L236.0775853415471,547.8820407152216L247.97846981845214,542.3896186757102L256.4914852472575,524.1317783854156L278.36600420225295,505.87966143553786L293.46615008302615,478.08276910288623L291.60366087515285,463.1288949009222L301.15832306235825,465.544541800381L327.07968782291573,446.64075551870974L331.042921134871,437.3255887027317L351.8434469175372,426.85910928605335Z"},
        { id: "city10014", name: "台東縣", d:"M456.88631245051147,715.1962702132814L468.75309076783014,715.3001385184089L469.4022470462951,731.9374398966947L458.0734406051197,722.4966255950585ZM455.2434203422272,434.11753792665786L448.70320133859786,459.69391836072737L443.10571145842914,464.79598005787375L436.4366387929258,481.5466957145154L435.865154570547,501.2875797703882L430.29387157706515,504.8906635291378L420.76200717725806,528.8681138255542L405.33397782653265,552.4922128426451L396.7634020498699,556.2878422155509L398.56939259367937,566.8936306563246L393.9809112389594,574.9445139876161L364.27828269522433,598.017560732992L361.7586766923632,610.552766668934L357.2378585762526,614.6079367199336L339.8248326521825,663.3829297460752L340.0905555925092,681.6902575098075L334.4043930379885,685.137577842509L321.25605699294465,675.4598904368613L318.7347325214432,661.1279280983572L311.52734739624066,655.7552030195056L319.60294776213414,646.1163496855688L312.31323318716386,637.6858742660579L314.4427013092063,628.8164091744575L309.9849042049427,618.3504559768517L314.1771400212856,602.0090955005808L321.15741716209595,589.721745455643L337.6365268979971,583.9017689539323L341.4355780122314,566.6757565311427L333.9989759340169,557.6621437532613L327.081719997037,544.7167470286286L325.61968581734254,533.0968037542034L333.24851812777706,523.2740246347657L338.7188680150248,503.98595285939973L338.47306210890747,496.4952957671967L343.76973569601614,475.3725966485217L354.2940021973991,466.3671126530444L365.43771031038705,462.9149629592921L370.81169770731503,464.3413571884266L376.05692551560423,476.32274419604164L386.85089751941996,482.89027502764657L396.382221478023,482.4329491208118L400.71212523547,494.6463327807305L410.7477332486087,503.2440213030786L420.6595639074476,501.90488139308854L432.2438525520847,463.1996920211732L438.6688057184292,452.708999120573L436.7964021502885,444.4963737665803L445.6345360635132,432.2920950360267Z"},
        { id: "city10015", name: "花蓮縣", d:"M508.6082165974585,249.2612153537666L502.8573992283673,260.63122469824975L489.04679213435156,272.3169104899698L487.43116187699707,287.3154355323859L478.86326277218177,296.76647628313003L484.38905175157925,313.72060860857164L477.4705039393666,329.60796993452095L469.90272113434185,366.7015660315783L456.6599967932416,416.49126645473643L455.2434203422272,434.11753792665786L445.6345360635132,432.2920950360267L436.7964021502885,444.4963737665803L438.6688057184292,452.708999120573L432.2438525520847,463.1996920211732L420.6595639074476,501.90488139308854L410.7477332486087,503.2440213030786L400.71212523547,494.6463327807305L396.382221478023,482.4329491208118L386.85089751941996,482.89027502764657L376.05692551560423,476.32274419604164L370.81169770731503,464.3413571884266L365.43771031038705,462.9149629592921L369.2466874960628,456.90258648171766L357.7173527943851,447.53580802057695L364.98594389374193,440.7892235317322L362.93129145685816,433.9937667927152L373.1553604367655,416.6072159899122L388.21329430784317,414.78189699402265L392.52426054478565,402.34496122858036L400.9163035379497,399.51506377103306L406.30173331343394,376.68525723563835L399.4194455541874,363.6557247038745L411.53867442062983,340.0192993969149L413.35476939104046,322.77957312865783L409.9376527785462,317.21312581769416L414.37175916750857,304.1931973405881L422.0363748291311,297.7434617700492L414.0186043597496,287.03069511627655L415.31396052089985,278.23697603512846L425.8538737070303,268.5779645993425L433.0444817326461,256.80146372034415L441.25385771106085,250.7486258241379L446.77873360401645,238.85097848886107L476.53850242975386,249.81672806308143L481.1323029546402,237.613582642216L497.1429695830593,246.84950205318273Z"},
      ],
    };
  },
  components: {},
  methods: {
    init_map() {
      // console.log(newData.features);
      const width = this.$refs.map.offsetWidth.toFixed(),
        height = this.$refs.map.offsetHeight.toFixed();
      console.log(width, height);
      let mercatorScale,
        w = window.screen.width;
      if (w > 1366) {
        mercatorScale = 11000;
      } else if (w <= 1366 && w > 480) {
        mercatorScale = 9000;
      } else {
        mercatorScale = 6000;
      }

      // 用外層的 div 當 svg 的寬高
      var path = d3.geo.path().projection(
        d3.geo
          .mercator()
          .center([121, 24])
          .scale(mercatorScale)
          .translate([width / 2, height / 2.5])
      );

      // 讓d3抓svg，並寫入寬高
      var svg = d3
        .select("#svg")
        .attr("width", width)
        .attr("height", height)
        .attr("viewBox", `0 0 ${width} ${height}`);

      // 讓d3抓GeoJSON檔，並寫入path的路徑
      var url = "https://twmapdata.herokuapp.com/";
      d3.json(url, (error, geometry) => {
        if (error) throw error;

        svg
          .selectAll("path")
          .data(geometry.features)
          .enter()
          .append("path")
          .attr("d", path)
          .attr({
            // 設定id，為了click時加class用
            id: (d) => "city" + d.properties.COUNTYCODE,
          })
          .on("click", (d) => {
            this.h1 = d.properties.COUNTYNAME; // 換中文名
            this.h2 = d.properties.COUNTYENG; // 換英文名
            // 有 .active 存在，就移除 .active
            if (document.querySelector(".active")) {
              document.querySelector(".active").classList.remove("active");
            }
            // 被點擊的縣市加上 .active
            document
              .getElementById("city" + d.properties.COUNTYCODE)
              .classList.add("active");
          });
      });
    },
    use_d3() {
      var that = this;
      var scriptTag = document.createElement("script");
      scriptTag.src =
        "https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js";
      scriptTag.id = "d3";
      document.getElementsByTagName("head")[0].appendChild(scriptTag);
      setTimeout(function () {
        // that.init_map()
      }, 500);
    },
    focus_map() {
      const that = this;
      var all_path = document.querySelectorAll("path");
      all_path.forEach(function (item, i) {
        // console.log(item.id);
        document
          .getElementById(item.id)
          .addEventListener("click", function (e) {
            // console.log(this);
            that.clear_all_active(all_path);
            this.classList.add("active");
          });
      });
    },
    clear_all_active(all_path) {
      all_path.forEach(function (item, i) {
        item.classList.remove("active");
      });
    },
    get_active(country){
      // console.log(country);
      this.$emit('get_active', country); 
    }
  },
  mounted() {
    this.use_d3();
    this.focus_map();
  },
};
</script>
<style scoped lang="scss">
@import "../assets/sass/main.scss";
#map {
  height: 1000px;
  fill: transparent;
  stroke: black;
  transform: translateX(-35%);
}
#map path {
  transition: all 0.3s;
  cursor: pointer;
  &.active {
    fill: $main_color--dark;
  }
  &:hover {
    fill: $main_color;
  }
}
</style>
